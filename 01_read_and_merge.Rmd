---
title: "Gaze Following Data Reading and Merge"
author: "Gaze following Analysis Team"
date: '`r format(Sys.time(), "%a %b %d %X %Y")`'
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: yes
---


# Intro

This script reads and merges data from the multi-lab gaze-following project.  This script takes data from eye-trackers that were pre-processed by gazepath scripts written by Daan van Renswoude, and hand-coded data in the same format. Credit to the much code borrowed from mb1/mb1b scripts.

* `01_read_and_merge` reads and merges the data. The goal of this file is to create a single inclusive file that has all data from all labs. 
* `02_variable_validation` corrects errors in variables and ensures that formats are correcvt. 
* `03_exclusion` reports exclusions and creates diff files. 
* `04_confirmatory_analysis` is the set of confirmatory analyses that were preregisted

# Participant Import 


```{r setup, echo=FALSE, message=FALSE}
source("helper/common.R")
```

Data import functions are factored into a helper functions file. 

```{r}
source("helper/preprocessing_helper.R")
```
    

# Reading in all participant data.  Excluding problematic columns.  Coercing to character if any problems

```{r}
participant_files <- dir("processed_data/participants_cleaned/", pattern = ".xlsx", all.files = FALSE)
participant_files <- paste0("processed_data/participants_cleaned/", participant_files) # Adds path to names


for (file in participant_files){

  myfile <- (file)
  
  # if the merged dataset does exist, append to it
  if (exists("dataset")){
    temp_dataset <- read_excel(file, col_names=TRUE) %>%
      mutate_all(as.character) %>%
      mutate_all(nc_na) %>%
      select(-(starts_with("Optional"))) %>%
      select(-(starts_with("parent")))%>%
      select(-contains("NAE")) %>%
      select(-starts_with("Bilingual")) %>%
      select(-contains("days_preterm")) %>%
      select(-contains("prev_earinfection")) %>%
      select(-contains("MacArthur"))
  
    
dataset <- full_join(dataset, temp_dataset)
    rm(temp_dataset)
  }
  
  # if the merged dataset doesn't exist, create it
  if (!exists("dataset")){
        dataset <- read_excel(file, col_names=TRUE) %>%
      mutate_all(as.character) %>%
      mutate_all(nc_na) %>%
      select(-(starts_with("Optional"))) %>%
      select(-(starts_with("parent")))%>%
      select(-contains("NAE")) %>%
      select(-starts_with("Bilingual")) %>%
      select(-contains("days_preterm")) %>%
      select(-contains("prev_earinfection")) %>%
      select(-contains("MacArthur"))
  
  }
  
}


```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

